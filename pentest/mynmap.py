#!/usr/bin/python3.6
# coding = utf-8


import nmap
import argparse
from threading import Thread, Semaphore


screenLock = Semaphore(1)


def __nmap_scan__(target_host: str, target_port: int) -> None:
    nm_scan = nmap.PortScanner()
    nm_scan.scan(target_host, target_port)
    state = nm_scan[target_host]['tcp'][target_port]['state']
    screenLock.acquire()
    print(" [*] %s tcp/%d %s" % target_host, target_port, state)
    screenLock.release()


def main():
    parser = argparse.ArgumentParser('Izvr≈°ava jednostavan port scan')
    parser.add_argument('-h', '--hosts', help='target hosts to scan',
                        required=True, type=str, nargs='+')
    parser.add_argument('-p', '--ports', help='target ports to scan',
                        required=True, type=int)
    args = parser.parse_args()

    if args.hosts is None or args.ports is None:
        parser.print_usage()
        exit(0)

    for host in args.hosts:
        for port in args.ports:
            Thread(target=__nmap_scan__, args=(host, port)).start


if __name__ == "__main__":
    main()
